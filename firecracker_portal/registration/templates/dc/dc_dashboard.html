{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <title>DC Dashboard</title>
  </head>
  <body>

    <h2 class='text-center mt-3'>District Commissioner Dashboard</h2>

    <!-- Add Bootstrap 5 CSS before the DataTables CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">

    <div class="container mt-4">
      <table 
        id="applications-table" 
        class="table table-striped table-bordered" 
        style="width:100%"
    >
      <thead>
        <tr>
          <th>Stall Name</th>
          <th>Location</th>
          <th>Description</th>
          <th>User</th>
          <th>HOD-fire</th>
          <th>HOD-Police</th>
          <th>HOD-Redcross</th>
          <th>Actions</th>
          <th>Submitted At</th>
          <th>Document</th>
        </tr>
      </thead>
      <tbody>
        {% for app in applications %}
        <tr>
          <td>{{ app.stall_name }}</td>
          <td>{{ app.location }}</td>
          <td>{{ app.description }}</td>
          <td>{{ app.user.email }}</td>
         <td>
            {% if app.hod_fire_status == "Approved" %}
              <span class="badge bg-success">Approved</span>
            {% elif app.hod_fire_status == "Rejected" %}
              <span class="badge bg-danger">Rejected</span>
            {% else %}
              <span class="badge bg-warning text-dark">Pending</span>
            {% endif %}
            </td>
            <td>
            {% if app.hod_police_status == "Approved" %}
              <span class="badge bg-success">Approved</span>
            {% elif app.hod_police_status == "Rejected" %}
              <span class="badge bg-danger">Rejected</span>
            {% else %}
              <span class="badge bg-warning text-dark">Pending</span>
            {% endif %}
            </td>
             <td>
            {% if app.hod_redcross_status == "Approved" %}
              <span class="badge bg-success">Approved</span>
            {% elif app.hod_redcross_status == "Rejected" %}
              <span class="badge bg-danger">Rejected</span>
            {% else %}
              <span class="badge bg-warning text-dark">Pending</span>
            {% endif %}
            </td>
          <td>
            {% if app.status == 'Pending' %}
            {% if app.hod_fire_status == "Approved" and app.hod_police_status == "Approved" and app.hod_redcross_status == "Approved" %}
            <a class="btn btn-sm btn-success" href="{% url 'approve_application' app.id %}">Final Approve</a>
            {% endif %}
            <a class="btn btn-sm btn-danger"  href="{% url 'reject_application' app.id %}">Reject</a>
            {% else %} {{ app.status }} {% endif %}
          </td>
           <td>
            {% if app.status == 'Pending' %}
            {{ app.submitted_at|date:"d M Y, h:i A" }}
            {% else %} {{ app.status }} {% endif %}
          </td>
          <td>
            {% if app.document %}
            <a class="btn btn-sm btn-primary mt-1" href="{{ app.document.url }}" target="_blank">View Document</a>
            {% endif %}
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- DataTables CSS/JS (CDN) -->
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

    <script>
      $(document).ready(function () {
        $("#applications-table").DataTable({
          pageLength: 10,
          lengthMenu: [
            [10, 25, 50, -1],
            [10, 25, 50, "All"],
          ],
          columnDefs: [
            { orderable: false, targets: -1 }, // disable ordering on Actions column
          ],
        });
      });
    </script>
  </body>
</html>
